name: ğŸ¤– GitAntivirus Node BOT (Scheduled)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# This is a TEMPLATE workflow for the Node BOT
# Place this under .github/workflows/ to enable scheduled bot runs
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

on:
  schedule:
    # Runs every Monday at 00:00 UTC
    - cron: '0 0 * * 1'
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Enable dry-run mode'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'

permissions:
  contents: read
  pull-requests: write
  issues: write

env:
  DRY_RUN: ${{ github.event.inputs.dry_run || 'true' }}
  BOT_PINGS_ENABLED: false
  ALLOWLIST_ORGS: ""
  MAX_PRS_PER_RUN: 3

jobs:
  run-bot:
    name: ğŸ¤– Run GitAntivirus BOT
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ğŸ“¦ Install pnpm
        run: |
          npm install -g pnpm
          pnpm --version
      
      - name: ğŸ“¥ Install bot dependencies
        working-directory: node/bot
        run: |
          pnpm install
      
      - name: ğŸ¤– Run GitAntivirus BOT
        working-directory: node/bot
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN || secrets.GITHUB_TOKEN }}
          DRY_RUN: ${{ env.DRY_RUN }}
          BOT_PINGS_ENABLED: ${{ env.BOT_PINGS_ENABLED }}
          ALLOWLIST_ORGS: ${{ env.ALLOWLIST_ORGS }}
          MAX_PRS_PER_RUN: ${{ env.MAX_PRS_PER_RUN }}
        run: |
          echo "ğŸ¤– Starting GitAntivirus BOT..."
          echo "Mode: ${DRY_RUN}"
          node index.js
      
      - name: ğŸ“Š Upload Bot Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: bot-logs-${{ github.run_number }}
          path: node/logs/
          retention-days: 30
          if-no-files-found: ignore
      
      - name: ğŸ“ Summary
        if: always()
        run: |
          echo "## ğŸ¤– GitAntivirus BOT Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Mode:** ${DRY_RUN}" >> $GITHUB_STEP_SUMMARY
          echo "- **Pings Enabled:** ${BOT_PINGS_ENABLED}" >> $GITHUB_STEP_SUMMARY
          echo "- **Status:** âœ… Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -f "node/logs/summary.json" ]; then
            echo "### Execution Summary" >> $GITHUB_STEP_SUMMARY
            cat node/logs/summary.json >> $GITHUB_STEP_SUMMARY
          fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# NOTES:
# - This workflow is a template placed in node/node.yml
# - Copy to .github/workflows/bot.yml to activate
# - Configure secrets: GH_TOKEN (for write operations)
# - Adjust schedule as needed
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
